## Brief guide life expectancy/healthy life expectancy indicators & ScotPHO profiles tool: 

# ONS and NRS are the main producers of LE and HLE estimates for UK nations and Scotland.
# Often these agencies work in tandem to produce estimates and release publications so publications come out on the same day (but should be consistent)

# Its should be noted that there are various different methodologies/tweaks to methodology that can be used when producing LE/HLE estimates for different time periods/geographies.
# Comparisons (including comparisons of trends) between different geography types (e.g. Scotland and NHS board/councils) should be done with caution,
# ensuring that the methodologies used to generate the series are equivalent/comparable.

# Headline life expectancy estimates are produced annually and will be 3 year period estimates compiled using unabrdiged (single-age) lifetables, these estimates are only produced for the UK nations (ie Scotland) level  
# These headline life expectancy figures should be considered the official estimates for Scotland. Estimates are typically published to 2 decimal places.

# Sub-national (ie NHS board/Council) 3-year period life expectancy estimates are released but these are produced using abridged (5 year ageband) life tables. To ensure fair comparison another set of 3-year LE estimates 
# are also published for Scotland using abridged life tables. These are typically published to 1 decimal place.

# It is advised that comparisons between LE estimated produced using abridged and unabridge life tables is avoided, this is part of the reason why ScotPHO profiles includes several different (but very similar looking) indicators.

# There are 3 indicators relating to life expectancy in the ScotPHO profiles tool (not all geography levels are available for all indicators)

1) life expectancy (Male & Female) - Scotland/NHSboard/Councils/HSCP (sub-national estimates generated by NRS/ONS using abrdiged life tables)- HSCP locality & IZ (small area estimates - generated by ScotPHO)
2) life expectancy inequalities (male & female) Scotland/NHSboard/Councils/HSCP
3) healthy life expectancy (male & female) Scotland/NHSboard/Councils
4) healthy life expectancy inequalities (male & female) Scotland level only 

In theory each indicator should be updated once per year but the timings of these updates throughout the year vary due to availability of source data.
We may update LE estimates for larger geographies before the HCSP locality and IZ updates 
(as the smaller geography data relies on release of SAPE populations when the larger geographies do not)

#There should be numerous scripts within the life expectancy sub-folder of profiles tool indicator production

#Scripts that source data from open data platorms/external files which are read:
0_Sourcing NRS 3yr Subnational abridged LE.R
0_Sourcing NRS 3 year Scotland deprivation.R [this is only used for long term monitoring of health inequalities only at Scotland level]

#Scripts that include declare filepaths/R libraries/functions used by other scripts in this project
 1.Functions_life_expectancy.R

#Scripts that prepare data files for indicators that appear in the ScotPHO profiles tool
 2.LE_generate small area estimates.R
 3.Profiles Indicators_LE_male and female.R
 4.Profiles Indicators_LE deprivation.R
 5.Profiles Indicators_HLE_2025 methodology
 
#scripts used in the past for updating indicators but not actively in use for future updates (keep in case we need to revert) 
 Archived_5. Profiles Indicators_healthy life expectancy.R

#NRS are the main producers of life expectancy (LE) and HLE estimates for Scotland, NHS boards and council areas.  

Only PHS ScotPHO team generate LE for small geographies - ie 2011 datazone and HSCP locality.  The scripts in this folder mostly source LE data from the SG opend data platform/NRS website or require 
a bespoke request for data from NRS. It is important to be aware that LE estimates for smaller geographies are calculated over 5 year periods rather than then NRS official estimates which are based on
3 year periods. This longer time period for smaller geographies is required to increase sample size and attempt to improve robustness of the estimates however there are some small geographies where the
is not sufficient sample size to permit calculation - for these geographies ScotPHO will suppress/not calculate LE.
Another difference between LE calculations for IZ/HSCP locality is that the maximum age group used in life tables is 85+ years rather than 90+ years - again this is due to issues with small numbers
(some small areas have zero population in the 90+ age group however some deaths are apparent which causes calculation errors).

To generate new LE figures for 2011 DZ & HSCP locality (including refreshing locality data when boundary changes take place) you will need to run script  
"2.LE_generate small area estimates.R" (which calls functions from the first script " 1.Functions_life_expectancy.R"), then run " 3.Profiles Indicators_LE male & female.R"

The source data for LE inequalities indicator is provided as a distinct file by NRS following a bespoke request to NRS (askinig for 5 year LE figures for Scotland, NHS board and LA by SIMD quintile)
Typically this data is provided at a different time to the official NRS publication and so SIMD splits for LE can't always be run at the same time as other LE indicators.

Healthy Life Expectancy figure are also sourced from NRS but are only available at Scotland, NHS board, Local Authority level - this is because there is no robust information on
self-assessed health for smaller geographies. 

#To update LE for small areas (ie IZ or HSCP locality)
Skip straight to script "2.LE_generate small area estimates.R"

#To update LE for Scotland, NHS board, Councils & HSCP:
Skip straight to script "3.Profiles Indicators_LE male & female.R"

#To update inequalities LE indicator for Scotland, NHS board, Councils:
Skip straight to  "4.Profiles Indicators_LE deprivation.R"

#To update inequalities HLE indicator for Scotland, NHS board, Councils:
Skip straight to  " 5.Profiles Indicators_HLE.R"